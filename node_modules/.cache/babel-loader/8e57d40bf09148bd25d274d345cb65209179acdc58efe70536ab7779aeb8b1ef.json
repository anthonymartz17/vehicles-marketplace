{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { getFirestore, collection, doc, getDoc, getDocs, addDoc, updateDoc, query, where } from \"firebase/firestore\";\nimport { getStorage, ref, getDownloadURL, uploadBytes } from \"firebase/storage\";\nimport { v4 as uuidv4 } from \"uuid\";\n// Create a reference to the storage service\nconst storage = getStorage();\n\n//initialize service\nconst db = getFirestore();\nexport default {\n  async getAds(dealerId) {\n    try {\n      const colRef = collection(db, \"cars\");\n      const q = query(colRef, where(\"dealerId\", \"==\", dealerId));\n      const snapshot = await getDocs(q);\n      const data = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      return data;\n    } catch (error) {\n      throw error;\n    }\n  },\n  async getVehicleById(vehicleId) {\n    try {\n      const carDocRef = doc(db, \"cars\", vehicleId);\n      const carDocSnapshot = await getDoc(carDocRef);\n      if (carDocSnapshot.exists()) {\n        return {\n          id: carDocSnapshot.id,\n          ...carDocSnapshot.data()\n        };\n      } else {\n        throw new Error(\"Vehicle not found.\");\n      }\n    } catch (error) {\n      throw error;\n    }\n  },\n  async createAd(vehicleData) {\n    try {\n      console.log(vehicleData, \"api\");\n      const colRef = collection(db, \"cars\");\n      const response = await addDoc(colRef, vehicleData);\n      return response;\n\n      // return profile\n    } catch (error) {\n      throw error;\n    }\n  },\n  async uploadImages({\n    vehicleImages,\n    vehicleId\n  }) {\n    try {\n      // const urlsUploaded = await Promise.all(\n      //uploads each image to firebase storage and returns array with url from each one\n      const uploadedImgPathPromised = vehicleImages.map(async img => {\n        //creates unique name id for image\n        const uniqueId = uuidv4();\n        const imageName = `images/cars/${vehicleId}_${uniqueId}_${img.name}`;\n\n        //creates refference unique for image\n        const storageRef = ref(storage, imageName);\n        //uploads image to firebase\n        await uploadBytes(storageRef, img);\n        return imageName;\n      });\n      const imgUploadedRefs = await Promise.all(uploadedImgRefPromised);\n      return imgUploadedRefs;\n    } catch (error) {\n      throw error;\n    }\n  },\n  async updateAd({\n    data,\n    vehicleId\n  }) {\n    try {\n      const vehicleDocRef = doc(db, \"cars\", vehicleId);\n      const vehicleDocSnapshot = await getDoc(vehicleDocRef);\n      console.log(vehicleDocSnapshot);\n      if (vehicleDocSnapshot.exists()) {\n        await updateDoc(vehicleDocRef, data);\n        return {\n          id: vehicleDocSnapshot.id,\n          ...vehicleDocSnapshot.data()\n        };\n      } else {\n        throw new Error(\"Car not found.\");\n      }\n    } catch (error) {\n      throw error;\n    }\n  },\n  async getDealers() {\n    try {\n      let dealersData = [];\n      const colRef = collection(db, \"dealers\");\n      const snapshot = await getDocs(colRef);\n      snapshot.docs.forEach(doc => {\n        dealersData.push({\n          id: doc.id,\n          ...doc.data()\n        });\n      });\n      return dealersData;\n    } catch (error) {\n      throw error;\n    }\n  },\n  async getDealerById(dealerId) {\n    console.log(dealerId, \"el dealer\");\n    try {\n      const dealerDocRef = doc(db, \"dealers\", dealerId);\n      const dealerDocSnapshot = await getDoc(dealerDocRef);\n      if (dealerDocSnapshot.exists()) {\n        return {\n          id: dealerDocSnapshot.id,\n          ...dealerDocSnapshot.data()\n        };\n      } else {\n        throw new Error(\"Dealer not found.\");\n      }\n    } catch (error) {\n      throw error;\n    }\n  }\n};\n// collection refference","map":{"version":3,"names":["getFirestore","collection","doc","getDoc","getDocs","addDoc","updateDoc","query","where","getStorage","ref","getDownloadURL","uploadBytes","v4","uuidv4","storage","db","getAds","dealerId","colRef","q","snapshot","data","docs","map","id","error","getVehicleById","vehicleId","carDocRef","carDocSnapshot","exists","Error","createAd","vehicleData","console","log","response","uploadImages","vehicleImages","uploadedImgPathPromised","img","uniqueId","imageName","name","storageRef","imgUploadedRefs","Promise","all","uploadedImgRefPromised","updateAd","vehicleDocRef","vehicleDocSnapshot","getDealers","dealersData","forEach","push","getDealerById","dealerDocRef","dealerDocSnapshot"],"sources":["D:/Cursos programacion/Projects Only/vehicles-marketplace/src/helpers/apiAds.js"],"sourcesContent":["import {\r\n\tgetFirestore,\r\n\tcollection,\r\n\tdoc,\r\n\tgetDoc,\r\n\tgetDocs,\r\n\taddDoc,\r\n\tupdateDoc,\r\n\tquery,\r\n\twhere,\r\n} from \"firebase/firestore\";\r\nimport { getStorage, ref, getDownloadURL, uploadBytes } from \"firebase/storage\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\n// Create a reference to the storage service\r\nconst storage = getStorage();\r\n\r\n//initialize service\r\nconst db = getFirestore();\r\n\r\nexport default {\r\n\tasync getAds(dealerId) {\r\n\t\ttry {\r\n\t\t\tconst colRef = collection(db, \"cars\");\r\n\t\t\tconst q = query(colRef, where(\"dealerId\", \"==\", dealerId));\r\n\t\t\tconst snapshot = await getDocs(q);\r\n\t\t\tconst data = snapshot.docs.map((doc) => ({\r\n\t\t\t\tid: doc.id,\r\n\t\t\t\t...doc.data(),\r\n\t\t\t}));\r\n\t\t\treturn data;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n\tasync getVehicleById(vehicleId) {\r\n\t\ttry {\r\n\t\t\tconst carDocRef = doc(db, \"cars\", vehicleId);\r\n\r\n\t\t\tconst carDocSnapshot = await getDoc(carDocRef);\r\n\r\n\t\t\tif (carDocSnapshot.exists()) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: carDocSnapshot.id,\r\n\t\t\t\t\t...carDocSnapshot.data(),\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Vehicle not found.\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n\tasync createAd(vehicleData) {\r\n\t\ttry {\r\n\t\t\tconsole.log(vehicleData, \"api\");\r\n\t\t\tconst colRef = collection(db, \"cars\");\r\n\r\n\t\t\tconst response = await addDoc(colRef, vehicleData);\r\n\r\n\t\t\treturn response;\r\n\r\n\t\t\t// return profile\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n\r\n\tasync uploadImages({ vehicleImages, vehicleId }) {\r\n\t\ttry {\r\n\t\t\t// const urlsUploaded = await Promise.all(\r\n\t\t\t//uploads each image to firebase storage and returns array with url from each one\r\n\t\t\tconst uploadedImgPathPromised = vehicleImages.map(async (img) => {\r\n\t\t\t\t//creates unique name id for image\r\n\t\t\t\tconst uniqueId = uuidv4();\r\n\t\t\t\tconst imageName = `images/cars/${vehicleId}_${uniqueId}_${img.name}`;\r\n\r\n\t\t\t\t//creates refference unique for image\r\n\t\t\t\tconst storageRef = ref(storage, imageName);\r\n\t\t\t\t//uploads image to firebase\r\n\t\t\t\tawait uploadBytes(storageRef, img);\r\n\r\n\t\t\t\treturn imageName;\r\n\t\t\t});\r\n\t\t\tconst imgUploadedRefs = await Promise.all(uploadedImgRefPromised);\r\n\t\t\treturn imgUploadedRefs;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n\tasync updateAd({ data, vehicleId }) {\r\n\t\ttry {\r\n\t\t\tconst vehicleDocRef = doc(db, \"cars\", vehicleId);\r\n\t\t\tconst vehicleDocSnapshot = await getDoc(vehicleDocRef);\r\n\t\t\tconsole.log(vehicleDocSnapshot);\r\n\t\t\tif (vehicleDocSnapshot.exists()) {\r\n\t\t\t\tawait updateDoc(vehicleDocRef, data);\r\n\t\t\t\treturn { id: vehicleDocSnapshot.id, ...vehicleDocSnapshot.data() };\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Car not found.\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n\r\n\tasync getDealers() {\r\n\t\ttry {\r\n\t\t\tlet dealersData = [];\r\n\t\t\tconst colRef = collection(db, \"dealers\");\r\n\t\t\tconst snapshot = await getDocs(colRef);\r\n\t\t\tsnapshot.docs.forEach((doc) => {\r\n\t\t\t\tdealersData.push({\r\n\t\t\t\t\tid: doc.id,\r\n\t\t\t\t\t...doc.data(),\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn dealersData;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n\tasync getDealerById(dealerId) {\r\n\t\tconsole.log(dealerId, \"el dealer\");\r\n\t\ttry {\r\n\t\t\tconst dealerDocRef = doc(db, \"dealers\", dealerId);\r\n\t\t\tconst dealerDocSnapshot = await getDoc(dealerDocRef);\r\n\r\n\t\t\tif (dealerDocSnapshot.exists()) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: dealerDocSnapshot.id,\r\n\t\t\t\t\t...dealerDocSnapshot.data(),\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Dealer not found.\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t},\r\n};\r\n// collection refference\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}