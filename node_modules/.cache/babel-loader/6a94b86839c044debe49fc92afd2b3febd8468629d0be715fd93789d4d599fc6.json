{"ast":null,"code":"import { required } from \"vuelidate/lib/validators\";\nexport default {\n  data() {\n    return {\n      user_name: \"\",\n      password: \"\",\n      submitted: false\n    };\n  },\n  validations: {\n    user_name: {\n      required\n    },\n    password: {\n      required\n    }\n  },\n  methods: {\n    async tryToLogIn() {\n      console.log(\"trying login\");\n      this.submitted = true;\n      // stop here if form is invalid\n      this.$v.$touch();\n      if (this.$v.$invalid) {\n        return;\n      } else {\n        if (process.env.VUE_APP_DEFAULT_AUTH === \"aws\") {\n          try {\n            let user = await this.$store.dispatch(\"auth/signIn\", {\n              username: this.user_name,\n              password: this.password\n            });\n            let cog_id = user.attributes.sub;\n            let userData = await ApiUser.getUserById(cog_id);\n            let allowed = false;\n            // console.log(user, \"user from sign in\");\n            // console.log(user.username, \"user from sign in\");\n            // console.log(user.storage.username, \"user from sign in\");\n            // console.log(user, \"user from sign in\");\n            if (Object.keys(userData).length == 0) {\n              let response = await ApiUser.createUser({\n                user_name: this.user_name,\n                email: user.attributes.email,\n                cog_id: cog_id,\n                Confirmed: 1\n              });\n              console.log(response, \"after created\");\n              allowed = true;\n            } else {\n              if (userData.active == 1 && userData.Confirmed == 1) {\n                allowed = true;\n              }\n            }\n            if (allowed) {\n              this.$router.replace({\n                name: \"dashboard\"\n              });\n            } else {\n              this.$store.dispatch(\"auth/signOut\");\n              this.$store.commit(\"auth/ALERT\", {\n                isSuccess: false,\n                isError: true,\n                alertMsg: \"account may be cancelled, unconfirmed, or it doesn't exist\"\n              });\n            }\n          } catch (error) {\n            this.$store.commit(\"auth/ALERT\", {\n              isSuccess: false,\n              isError: true,\n              alertMsg: error\n            });\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["required","data","user_name","password","submitted","validations","methods","tryToLogIn","console","log","$v","$touch","$invalid","process","env","VUE_APP_DEFAULT_AUTH","user","$store","dispatch","username","cog_id","attributes","sub","userData","ApiUser","getUserById","allowed","Object","keys","length","response","createUser","email","Confirmed","active","$router","replace","name","commit","isSuccess","isError","alertMsg","error"],"sources":["src/views/joinus/login-page.vue"],"sourcesContent":["<script>\r\nimport { required } from \"vuelidate/lib/validators\";\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tuser_name: \"\",\r\n\t\t\tpassword: \"\",\r\n\t\t\tsubmitted: false,\r\n\t\t};\r\n\t},\r\n\tvalidations: {\r\n\t\tuser_name: { required },\r\n\t\tpassword: { required },\r\n\t},\r\n\tmethods: {\r\n\t\tasync tryToLogIn() {\r\n\t\t\tconsole.log(\"trying login\");\r\n\t\t\tthis.submitted = true;\r\n\t\t\t// stop here if form is invalid\r\n\t\t\tthis.$v.$touch();\r\n\r\n\t\t\tif (this.$v.$invalid) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tif (process.env.VUE_APP_DEFAULT_AUTH === \"aws\") {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tlet user = await this.$store.dispatch(\"auth/signIn\", {\r\n\t\t\t\t\t\t\tusername: this.user_name,\r\n\t\t\t\t\t\t\tpassword: this.password,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tlet cog_id = user.attributes.sub;\r\n\t\t\t\t\t\tlet userData = await ApiUser.getUserById(cog_id);\r\n\t\t\t\t\t\tlet allowed = false;\r\n\t\t\t\t\t\t// console.log(user, \"user from sign in\");\r\n\t\t\t\t\t\t// console.log(user.username, \"user from sign in\");\r\n\t\t\t\t\t\t// console.log(user.storage.username, \"user from sign in\");\r\n\t\t\t\t\t\t// console.log(user, \"user from sign in\");\r\n\t\t\t\t\t\tif (Object.keys(userData).length == 0) {\r\n\t\t\t\t\t\t\tlet response = await ApiUser.createUser({\r\n\t\t\t\t\t\t\t\tuser_name: this.user_name,\r\n\t\t\t\t\t\t\t\temail: user.attributes.email,\r\n\t\t\t\t\t\t\t\tcog_id: cog_id,\r\n\t\t\t\t\t\t\t\tConfirmed: 1,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconsole.log(response, \"after created\");\r\n\t\t\t\t\t\t\tallowed = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (userData.active == 1 && userData.Confirmed == 1) {\r\n\t\t\t\t\t\t\t\tallowed = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (allowed) {\r\n\t\t\t\t\t\t\tthis.$router.replace({ name: \"dashboard\" });\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.$store.dispatch(\"auth/signOut\");\r\n\t\t\t\t\t\t\tthis.$store.commit(\"auth/ALERT\", {\r\n\t\t\t\t\t\t\t\tisSuccess: false,\r\n\t\t\t\t\t\t\t\tisError: true,\r\n\t\t\t\t\t\t\t\talertMsg:\r\n\t\t\t\t\t\t\t\t\t\"account may be cancelled, unconfirmed, or it doesn't exist\",\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tthis.$store.commit(\"auth/ALERT\", {\r\n\t\t\t\t\t\t\tisSuccess: false,\r\n\t\t\t\t\t\t\tisError: true,\r\n\t\t\t\t\t\t\talertMsg: error,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n<template>\r\n\t<div>\r\n\t\t<form class=\"p-2\" @submit.prevent=\"tryToLogIn\">\r\n\t\t\t<div class=\"\">\r\n\t\t\t\t<label for=\"input-1\" class=\"form-label\">User Name</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\tid=\"input-1\"\r\n\t\t\t\t\tv-model=\"user_name\"\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tplaceholder=\"Enter username\"\r\n\t\t\t\t\t:class=\"{ 'is-invalid': submitted && !$v.user_name.required }\"\r\n\t\t\t\t/>\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-if=\"submitted && !$v.user_name.required\"\r\n\t\t\t\t\tclass=\"invalid-feedback\"\r\n\t\t\t\t>\r\n\t\t\t\t\tUsername is required.\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"mb-3\" id=\"input-group-2\">\r\n\t\t\t\t<label for=\"input-2\" class=\"form-label\">Password</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\tid=\"input-2\"\r\n\t\t\t\t\tv-model=\"password\"\r\n\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\tplaceholder=\"Enter password\"\r\n\t\t\t\t\t:class=\"{ 'is-invalid': submitted && !$v.password.required }\"\r\n\t\t\t\t/>\r\n\t\t\t\t<div v-if=\"submitted && !$v.password.required\" class=\"invalid-feedback\">\r\n\t\t\t\t\tPassword is required.\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"form-check mb-3\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tclass=\"form-check-input\"\r\n\t\t\t\t\tid=\"customControlInline\"\r\n\t\t\t\t\tname=\"checkbox-1\"\r\n\t\t\t\t\tvalue=\"accepted\"\r\n\t\t\t\t\t:unchecked-value=\"not_accepted\"\r\n\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t/>\r\n\t\t\t\t<label class=\"form-check-label\" for=\"customControlInline\">\r\n\t\t\t\t\tRemember me\r\n\t\t\t\t</label>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"mt-3 d-grid\">\r\n\t\t\t\t<button type=\"submit\" class=\"btn btn-primary btn-block\">Log In</button>\r\n\t\t\t</div>\r\n\t\t</form>\r\n\t</div>\r\n</template>\r\n\r\n<style scoped>\r\n.invalid-feedback {\r\n\tcolor: red;\r\n}\r\n</style>\r\n"],"mappings":"AACA,SAAAA,QAAA;AAEA;EACAC,KAAA;IACA;MACAC,SAAA;MACAC,QAAA;MACAC,SAAA;IACA;EACA;EACAC,WAAA;IACAH,SAAA;MAAAF;IAAA;IACAG,QAAA;MAAAH;IAAA;EACA;EACAM,OAAA;IACA,MAAAC,WAAA;MACAC,OAAA,CAAAC,GAAA;MACA,KAAAL,SAAA;MACA;MACA,KAAAM,EAAA,CAAAC,MAAA;MAEA,SAAAD,EAAA,CAAAE,QAAA;QACA;MACA;QACA,IAAAC,OAAA,CAAAC,GAAA,CAAAC,oBAAA;UACA;YACA,IAAAC,IAAA,cAAAC,MAAA,CAAAC,QAAA;cACAC,QAAA,OAAAjB,SAAA;cACAC,QAAA,OAAAA;YACA;YACA,IAAAiB,MAAA,GAAAJ,IAAA,CAAAK,UAAA,CAAAC,GAAA;YACA,IAAAC,QAAA,SAAAC,OAAA,CAAAC,WAAA,CAAAL,MAAA;YACA,IAAAM,OAAA;YACA;YACA;YACA;YACA;YACA,IAAAC,MAAA,CAAAC,IAAA,CAAAL,QAAA,EAAAM,MAAA;cACA,IAAAC,QAAA,SAAAN,OAAA,CAAAO,UAAA;gBACA7B,SAAA,OAAAA,SAAA;gBACA8B,KAAA,EAAAhB,IAAA,CAAAK,UAAA,CAAAW,KAAA;gBACAZ,MAAA,EAAAA,MAAA;gBACAa,SAAA;cACA;cACAzB,OAAA,CAAAC,GAAA,CAAAqB,QAAA;cACAJ,OAAA;YACA;cACA,IAAAH,QAAA,CAAAW,MAAA,SAAAX,QAAA,CAAAU,SAAA;gBACAP,OAAA;cACA;YACA;YACA,IAAAA,OAAA;cACA,KAAAS,OAAA,CAAAC,OAAA;gBAAAC,IAAA;cAAA;YACA;cACA,KAAApB,MAAA,CAAAC,QAAA;cACA,KAAAD,MAAA,CAAAqB,MAAA;gBACAC,SAAA;gBACAC,OAAA;gBACAC,QAAA,EACA;cACA;YACA;UACA,SAAAC,KAAA;YACA,KAAAzB,MAAA,CAAAqB,MAAA;cACAC,SAAA;cACAC,OAAA;cACAC,QAAA,EAAAC;YACA;UACA;QACA;MACA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}