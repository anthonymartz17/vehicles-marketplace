{"ast":null,"code":"import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, EmailAuthProvider, reauthenticateWithCredential, updatePassword } from \"firebase/auth\";\nimport auth from \"./\";\nimport apiProfile from \"../../helpers/apiProfile\";\n\n//global timer for expiration token\nlet timer;\nexport default {\n  namespaced: true,\n  state: {\n    user: null,\n    alert: {}\n  },\n  mutations: {\n    SET_USER(state, payload) {\n      state.user = payload;\n    },\n    SET_ALERT_MSG(state, payload) {\n      state.alert = payload;\n      console.log({\n        ...state.alert\n      });\n    },\n    TOGGLE_LINK_VISIBILITY(state, {\n      link,\n      isLoggedIn\n    }) {\n      let showNav = true;\n      if (link == \"Dashboard\" && !isLoggedIn || link == \"Join Us\" && isLoggedIn || link == \"Log Out\" && !isLoggedIn) {\n        showNav = false;\n      }\n      return showNav;\n    }\n  },\n  actions: {\n    async signUp({\n      commit\n    }, {\n      email,\n      password\n    }) {\n      try {\n        let response = await createUserWithEmailAndPassword(getAuth(), email, password);\n        return response.user;\n      } catch (error) {\n        throw error;\n      }\n    },\n    async signIn({\n      commit,\n      dispatch\n    }, {\n      email,\n      password\n    }) {\n      try {\n        let response = await signInWithEmailAndPassword(getAuth(), email, password);\n        const currentUser = response._tokenResponse.email;\n        const token = response._tokenResponse.idToken;\n        const expiresIn = response._tokenResponse.expiresIn;\n        const userProfile = await apiProfile.getByAuthId(response.user.uid);\n        const username = userProfile[0].name;\n        const dealerId = userProfile[0].id;\n        const isActive = userProfile[0].active;\n        clearTimeout(timer);\n        timer = setTimeout(() => {\n          dispatch(\"singOutUser\");\n          //expects timer in miliseconds\n        }, expiresIn * 1000);\n        commit(\"SET_USER\", {\n          currentUser,\n          token,\n          isActive,\n          dealerId,\n          username\n        });\n        localStorage.setItem(\"currentUserDealer\", JSON.stringify({\n          currentUser,\n          token,\n          isActive,\n          dealerId,\n          username\n        }));\n        return response.user;\n      } catch (error) {\n        throw error;\n      }\n    },\n    async autoLogIn({\n      commit\n    }) {\n      const currentUserDealer = JSON.parse(localStorage.getItem(\"currentUserDealer\"));\n      if (currentUserDealer) if (currentUserDealer.currentUser && currentUserDealer.token) {\n        commit(\"SET_USER\", currentUserDealer);\n      }\n    },\n    async signOutUser({\n      commit\n    }) {\n      try {\n        await signOut(getAuth());\n        localStorage.removeItem(\"currentUserDealer\");\n        commit(\"SET_USER\", null);\n        clearTimeout(timer);\n      } catch (error) {\n        throw error;\n      }\n    },\n    async changePassword(_, {\n      currentPassword,\n      newPassword\n    }) {\n      try {\n        const user = getAuth().currentUser;\n        if (user) {\n          let credential = EmailAuthProvider.credential(getAuth(), user.email, currentPassword);\n          console.log(user, \"user\");\n          console.log(credential, \"credential\");\n          // Re-authenticate the user with their current password\n          const test = await reauthenticateWithCredential(user, credential);\n          console.log(test, \"test\");\n\n          // Change the password\n          await updatePassword(user, newPassword);\n        } else {\n          console.log('no listo');\n        }\n      } catch (error) {\n        throw error;\n      }\n    }\n  },\n  getters: {\n    isLoggedIn: state => !!(state.user && state.user.isActive),\n    showAlert: state => !!Object.keys(state.alert).length\n  }\n};","map":{"version":3,"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","EmailAuthProvider","reauthenticateWithCredential","updatePassword","auth","apiProfile","timer","namespaced","state","user","alert","mutations","SET_USER","payload","SET_ALERT_MSG","console","log","TOGGLE_LINK_VISIBILITY","link","isLoggedIn","showNav","actions","signUp","commit","email","password","response","getAuth","error","signIn","dispatch","currentUser","_tokenResponse","token","idToken","expiresIn","userProfile","getByAuthId","uid","username","name","dealerId","id","isActive","active","clearTimeout","setTimeout","localStorage","setItem","JSON","stringify","autoLogIn","currentUserDealer","parse","getItem","signOutUser","removeItem","changePassword","_","currentPassword","newPassword","credential","test","getters","showAlert","Object","keys","length"],"sources":["D:/Cursos programacion/Projects Only/vehicles-marketplace/src/store/modules/auth.js"],"sourcesContent":["import {\r\n\tcreateUserWithEmailAndPassword,\r\n\tsignInWithEmailAndPassword,\r\n\tsignOut,\r\n\tEmailAuthProvider,\r\n\treauthenticateWithCredential,\r\n\tupdatePassword,\r\n} from \"firebase/auth\";\r\nimport auth from \"./\"\r\nimport apiProfile from \"../../helpers/apiProfile\";\r\n\r\n//global timer for expiration token\r\nlet timer;\r\nexport default {\r\n\tnamespaced: true,\r\n\tstate: {\r\n\t\tuser: null,\r\n\t\talert: {},\r\n\t},\r\n\tmutations: {\r\n\t\tSET_USER(state, payload) {\r\n\t\t\tstate.user = payload;\r\n\t\t},\r\n\t\tSET_ALERT_MSG(state, payload) {\r\n\t\t\tstate.alert = payload;\r\n\t\t\tconsole.log({ ...state.alert });\r\n\t\t},\r\n\t\tTOGGLE_LINK_VISIBILITY(state, { link, isLoggedIn }) {\r\n\t\t\tlet showNav = true;\r\n\t\t\tif (\r\n\t\t\t\t(link == \"Dashboard\" && !isLoggedIn) ||\r\n\t\t\t\t(link == \"Join Us\" && isLoggedIn) ||\r\n\t\t\t\t(link == \"Log Out\" && !isLoggedIn)\r\n\t\t\t) {\r\n\t\t\t\tshowNav = false;\r\n\t\t\t}\r\n\t\t\treturn showNav;\r\n\t\t},\r\n\t},\r\n\tactions: {\r\n\t\tasync signUp({ commit }, { email, password }) {\r\n\t\t\ttry {\r\n\t\t\t\tlet response = await createUserWithEmailAndPassword(\r\n\t\t\t\t\tgetAuth(),\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tpassword\r\n\t\t\t\t);\r\n\t\t\t\treturn response.user;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync signIn({ commit, dispatch }, { email, password }) {\r\n\t\t\ttry {\r\n\t\t\t\tlet response = await signInWithEmailAndPassword(\r\n\t\t\t\t\tgetAuth(),\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tpassword\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst currentUser = response._tokenResponse.email;\r\n\t\t\t\tconst token = response._tokenResponse.idToken;\r\n\t\t\t\tconst expiresIn = response._tokenResponse.expiresIn;\r\n\t\t\t\tconst userProfile = await apiProfile.getByAuthId(response.user.uid);\r\n\t\t\t\tconst username = userProfile[0].name;\r\n\t\t\t\tconst dealerId = userProfile[0].id;\r\n\t\t\t\tconst isActive = userProfile[0].active;\r\n\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\t\tdispatch(\"singOutUser\");\r\n\t\t\t\t\t//expects timer in miliseconds\r\n\t\t\t\t}, expiresIn * 1000);\r\n\r\n\t\t\t\tcommit(\"SET_USER\", {\r\n\t\t\t\t\tcurrentUser,\r\n\t\t\t\t\ttoken,\r\n\t\t\t\t\tisActive,\r\n\t\t\t\t\tdealerId,\r\n\t\t\t\t\tusername,\r\n\t\t\t\t});\r\n\t\t\t\tlocalStorage.setItem(\r\n\t\t\t\t\t\"currentUserDealer\",\r\n\t\t\t\t\tJSON.stringify({ currentUser, token, isActive, dealerId, username })\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn response.user;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync autoLogIn({ commit }) {\r\n\t\t\tconst currentUserDealer = JSON.parse(\r\n\t\t\t\tlocalStorage.getItem(\"currentUserDealer\")\r\n\t\t\t);\r\n\t\t\tif (currentUserDealer)\r\n\t\t\t\tif (currentUserDealer.currentUser && currentUserDealer.token) {\r\n\t\t\t\t\tcommit(\"SET_USER\", currentUserDealer);\r\n\t\t\t\t}\r\n\t\t},\r\n\t\tasync signOutUser({ commit }) {\r\n\t\t\ttry {\r\n\t\t\t\tawait signOut(getAuth());\r\n\t\t\t\tlocalStorage.removeItem(\"currentUserDealer\");\r\n\t\t\t\tcommit(\"SET_USER\", null);\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync changePassword(_, { currentPassword, newPassword }) {\r\n\t\t\ttry {\r\n\t\t\t\tconst user = getAuth().currentUser;\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\tlet credential = EmailAuthProvider.credential(\r\n\t\t\t\t\t\tgetAuth(),\r\n\t\t\t\t\t\tuser.email,\r\n\t\t\t\t\t\tcurrentPassword\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconsole.log(user, \"user\");\r\n\t\t\t\t\tconsole.log(credential, \"credential\");\r\n\t\t\t\t\t// Re-authenticate the user with their current password\r\n\t\t\t\t\tconst test = await reauthenticateWithCredential(user, credential);\r\n\t\t\t\t\tconsole.log(test, \"test\");\r\n\r\n\t\t\t\t\t// Change the password\r\n\t\t\t\t\tawait updatePassword(user, newPassword);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('no listo')\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tgetters: {\r\n\t\tisLoggedIn: (state) => !!(state.user && state.user.isActive),\r\n\t\tshowAlert: (state) => !!Object.keys(state.alert).length,\r\n\t},\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}