{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport apiAds from \"../../helpers/apiAds\";\nimport apiCarsImages from \"../../helpers/apiCarsImages\";\nimport vehicles from \"./vehicles\";\nexport default {\n  namespaced: true,\n  state: {\n    ads: [],\n    vehiclePost: {\n      //initialized list to be able to use it in step 4 create post\n      pics: []\n    }\n  },\n  mutations: {\n    UPDATE_VEHICLE(state, payload) {\n      Object.assign(state.vehiclePost, payload);\n    },\n    UPDATE_VEHICLE_POST(state, newValue) {\n      state.vehiclePost;\n    },\n    SET(state, payload) {\n      state.ads = payload;\n    },\n    CREATE(state, payload) {\n      state.ads.push(payload);\n    },\n    UPDATE(state, payload) {\n      state.ads.find(item => {\n        if (item.id == payload.id) {\n          Object.assign(item, payload);\n        }\n      });\n    },\n    DELETE(state, id) {\n      state.ads = state.ads.filter(x => x.id !== id);\n    }\n  },\n  getters: {\n    adsList(state) {\n      if (state.ads) {\n        return state.ads;\n      }\n    }\n  },\n  actions: {\n    async fetchAds({\n      commit\n    }, dealerId) {\n      // shows loading animation while getting the data\n      // commit(\"SWITCH_LOADING\");\n      console.log(dealerId);\n      try {\n        let data = await apiAds.getAds(dealerId);\n        // fetch images url in firestore storage & adds each corresponding list of urls to the proper car in cars list.\n        let dataUrl = await apiCarsImages.getCarsImages(data);\n        console.log(dataUrl);\n        data.forEach(one => {\n          let imagesUrl = dataUrl.find(x => x.id == one.id).imagesUrl;\n          one.carPicsUrls = imagesUrl;\n        });\n        commit(\"SET\", data);\n        return data;\n      } catch (error) {\n        throw error;\n      } finally {\n        // turns loading to false\n        // commit(\"SWITCH_LOADING\");\n      }\n    },\n    async fetchVehicleById(_, vehicleId) {\n      try {\n        let vehicle = await apiVehicles.getVehicleById(vehicleId);\n        let imagesUrl = await apiCarsImages.getImagesById(vehicle.pics);\n        vehicle.carPicsUrls = imagesUrl;\n        return vehicle;\n      } catch (error) {\n        throw error;\n      } finally {\n        // turns loading to false\n        // commit(\"SWITCH_LOADING\");\n      }\n    },\n    async createAd(_, {\n      data,\n      listImg\n    }) {\n      try {\n        console.log(data, \"state\");\n        const createdPost = await apiAds.createAd(data);\n        console.log(data);\n        const uploadedImages = await apiAds.uploadImages({\n          imgFiles: listImg,\n          carId: createdPost.id\n        });\n        data.pics = uploadedImages;\n        const updateAd = await apiAds.updateAd({\n          data,\n          vehicleId: createdPost.id\n        });\n        console.log(updateAd, 'full ad');\n      } catch (error) {\n        throw error;\n      }\n    },\n    async uploadImages(_, data) {\n      try {\n        const response = await apiAds.uploadImages(data);\n        console.log(response, \"images uploaded, state\");\n      } catch (error) {\n        throw error;\n      }\n    },\n    async updateAd(_, data) {\n      try {\n        const response = await apiAds.updateAd(data);\n        console.log(response, \"images uploaded, state\");\n      } catch (error) {\n        throw error;\n      }\n    },\n    async fetchDealers({\n      commit\n    }) {\n      // shows loading animation while getting the data\n      // commit(\"SWITCH_LOADING\");\n      try {\n        let data = await apiVehicles.getDealers();\n        commit(\"SET_DEALERS\", data);\n        return data;\n      } catch (error) {\n        throw error;\n      } finally {\n        // turns loading to false\n        // commit(\"SWITCH_LOADING\");\n      }\n    },\n    async fetchDealerById(_, dealerId) {\n      try {\n        let dealer = await apiVehicles.getDealerById(dealerId);\n        return dealer;\n      } catch (error) {\n        throw error;\n      } finally {\n        // turns loading to false\n        // commit(\"SWITCH_LOADING\");\n      }\n    },\n    updateVehiclePost({\n      commit\n    }, newValue) {\n      commit('UPDATE_VEHICLE_POST', newValue);\n    }\n  }\n};","map":{"version":3,"names":["apiAds","apiCarsImages","vehicles","namespaced","state","ads","vehiclePost","pics","mutations","UPDATE_VEHICLE","payload","Object","assign","UPDATE_VEHICLE_POST","newValue","SET","CREATE","push","UPDATE","find","item","id","DELETE","filter","x","getters","adsList","actions","fetchAds","commit","dealerId","console","log","data","getAds","dataUrl","getCarsImages","forEach","one","imagesUrl","carPicsUrls","error","fetchVehicleById","_","vehicleId","vehicle","apiVehicles","getVehicleById","getImagesById","createAd","listImg","createdPost","uploadedImages","uploadImages","imgFiles","carId","updateAd","response","fetchDealers","getDealers","fetchDealerById","dealer","getDealerById","updateVehiclePost"],"sources":["D:/Cursos programacion/Projects Only/vehicles-marketplace/src/store/modules/adsCrud.js"],"sourcesContent":["import apiAds from \"../../helpers/apiAds\";\r\nimport apiCarsImages from \"../../helpers/apiCarsImages\";\r\nimport vehicles from \"./vehicles\";\r\n\r\nexport default {\r\n\tnamespaced: true,\r\n\r\n\tstate: {\r\n\t\tads: [],\r\n\t\tvehiclePost: {\r\n\t\t\t//initialized list to be able to use it in step 4 create post\r\n\t\t\tpics:[]\r\n\t\t},\r\n\t},\r\n\tmutations: {\r\n\t\tUPDATE_VEHICLE(state, payload) {\r\n\t\t\tObject.assign(state.vehiclePost, payload);\r\n\t\t},\r\n\t\tUPDATE_VEHICLE_POST(state,newValue) {\r\n\t\t\tstate.vehiclePost\r\n\t\t},\r\n\t\tSET(state, payload) {\r\n\t\t\tstate.ads = payload;\r\n\t\t},\r\n\t\tCREATE(state, payload) {\r\n\t\t\tstate.ads.push(payload);\r\n\t\t},\r\n\t\tUPDATE(state, payload) {\r\n\t\t\tstate.ads.find((item) => {\r\n\t\t\t\tif (item.id == payload.id) {\r\n\t\t\t\t\tObject.assign(item, payload);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tDELETE(state, id) {\r\n\t\t\tstate.ads = state.ads.filter((x) => x.id !== id);\r\n\t\t},\r\n\t},\r\n\r\n\tgetters: {\r\n\t\tadsList(state) {\r\n\t\t\tif (state.ads) {\r\n\t\t\t\treturn state.ads;\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\r\n\tactions: {\r\n\t\tasync fetchAds({ commit }, dealerId) {\r\n\t\t\t// shows loading animation while getting the data\r\n\t\t\t// commit(\"SWITCH_LOADING\");\r\n\t\t\tconsole.log(dealerId)\r\n\t\t\ttry {\r\n\t\t\t\tlet data = await apiAds.getAds(dealerId);\r\n\t\t\t\t// fetch images url in firestore storage & adds each corresponding list of urls to the proper car in cars list.\r\n\t\t\t\tlet dataUrl = await apiCarsImages.getCarsImages(data);\r\n\t\t\t\tconsole.log(dataUrl)\r\n\r\n\t\t\t\tdata.forEach((one) => {\r\n\t\t\t\t\tlet imagesUrl = dataUrl.find((x) => x.id == one.id).imagesUrl;\r\n\t\t\t\t\tone.carPicsUrls = imagesUrl;\r\n\t\t\t\t});\r\n\t\t\t\tcommit(\"SET\", data);\r\n\t\t\t\treturn data;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t} finally {\r\n\t\t\t\t// turns loading to false\r\n\t\t\t\t// commit(\"SWITCH_LOADING\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync fetchVehicleById(_, vehicleId) {\r\n\t\t\ttry {\r\n\t\t\t\tlet vehicle = await apiVehicles.getVehicleById(vehicleId);\r\n\t\t\t\tlet imagesUrl = await apiCarsImages.getImagesById(vehicle.pics);\r\n\t\t\t\tvehicle.carPicsUrls = imagesUrl;\r\n\t\t\t\treturn vehicle;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t} finally {\r\n\t\t\t\t// turns loading to false\r\n\t\t\t\t// commit(\"SWITCH_LOADING\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync createAd(_, {data,listImg}) {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log(data, \"state\");\r\n\t\t\t\tconst createdPost = await apiAds.createAd(data);\r\n\t\t\t\tconsole.log(data)\r\n\t\t\t\tconst uploadedImages = await apiAds.uploadImages({\r\n\t\t\t\t\timgFiles: listImg,\r\n\t\t\t\t\tcarId: createdPost.id,\r\n\t\t\t\t});\r\n\t\t\t\tdata.pics = uploadedImages;\r\n\t\t\t\tconst updateAd = await apiAds.updateAd({\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\tvehicleId: createdPost.id,\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(updateAd,'full ad');\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync uploadImages(_, data) {\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await apiAds.uploadImages(data);\r\n\t\t\t\tconsole.log(response, \"images uploaded, state\");\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync updateAd(_, data) {\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await apiAds.updateAd(data);\r\n\t\t\t\tconsole.log(response, \"images uploaded, state\");\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync fetchDealers({ commit }) {\r\n\t\t\t// shows loading animation while getting the data\r\n\t\t\t// commit(\"SWITCH_LOADING\");\r\n\t\t\ttry {\r\n\t\t\t\tlet data = await apiVehicles.getDealers();\r\n\t\t\t\tcommit(\"SET_DEALERS\", data);\r\n\t\t\t\treturn data;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t} finally {\r\n\t\t\t\t// turns loading to false\r\n\t\t\t\t// commit(\"SWITCH_LOADING\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync fetchDealerById(_, dealerId) {\r\n\t\t\ttry {\r\n\t\t\t\tlet dealer = await apiVehicles.getDealerById(dealerId);\r\n\t\t\t\treturn dealer;\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthrow error;\r\n\t\t\t} finally {\r\n\t\t\t\t// turns loading to false\r\n\t\t\t\t// commit(\"SWITCH_LOADING\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tupdateVehiclePost({commit},newValue) {\r\n\t\t\tcommit('UPDATE_VEHICLE_POST',newValue)\r\n\t\t}\r\n\t},\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}